#!/bin/bash

echo "Posting comment on PR..."

# Use the environment variables set by GitHub Actions
REPOSITORY="${GITHUB_REPOSITORY}"
PR_NUMBER="${GITHUB_EVENT_PULL_REQUEST_NUMBER}"
TOKEN="${GITHUB_TOKEN}"
RESULTS="${ANALYSIS_RESULTS}"

COMMENT_BODY=$(cat << EOF
# Code Analysis Report

${RESULTS}

---

- :white_check_mark: **[Approve](https://github.com/${REPOSITORY}/pull/${PR_NUMBER}/feedback?approve=true)**
- :x: **[Reject](https://github.com/${REPOSITORY}/pull/${PR_NUMBER}/feedback?approve=false)**

*Generated by AI Code Analysis*
EOF
)

# Post the comment to the pull request
curl -X POST \
  -H "Authorization: Bearer ${TOKEN}" \
  -H "Accept: application/vnd.github.v3+json" \
  -d "{\"body\": $(echo "$COMMENT_BODY" | jq -sR)}" \
  "https://api.github.com/repos/${REPOSITORY}/issues/${PR_NUMBER}/comments"
